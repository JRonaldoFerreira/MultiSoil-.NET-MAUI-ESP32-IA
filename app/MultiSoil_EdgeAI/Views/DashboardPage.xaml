<ContentPage x:Class="MultiSoil_EdgeAI.Views.DashboardPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:beh="clr-namespace:MultiSoil_EdgeAI.Behaviors"
             xmlns:vm="clr-namespace:MultiSoil_EdgeAI.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="vm:DashboardViewModel"
             BackgroundColor="{toolkit:AppThemeResource SurfaceColor}">

    <ContentPage.Behaviors>
        <beh:AuthGuardBehavior/>
    </ContentPage.Behaviors>

    <!-- ===== THEME & STYLES (CommunityToolkit) ===== -->
    <ContentPage.Resources>
        <ResourceDictionary>

            <!-- Cores com tema (Toolkit) -->
            <toolkit:AppThemeColor x:Key="PrimaryColor" Light="#2563EB" Dark="#3B82F6" />
            <toolkit:AppThemeColor x:Key="OnPrimaryColor" Light="#FFFFFF" Dark="#0B1220" />
            <toolkit:AppThemeColor x:Key="SurfaceColor" Light="#F6F7FB" Dark="#111315" />
            <toolkit:AppThemeColor x:Key="CardColor" Light="#FFFFFF" Dark="#1E2226" />
            <toolkit:AppThemeColor x:Key="SecondaryColor" Light="#E5E7EB" Dark="#2A2F36" />
            <Color x:Key="MutedText">#8892A6</Color>

            <!-- Tipografia -->
            <Style x:Key="H1" TargetType="Label">
                <Setter Property="FontSize" Value="28" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{toolkit:AppThemeResource OnPrimaryColor}" />
            </Style>

            <Style x:Key="H2" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#0F172A, Dark=#E5E7EB}" />
            </Style>

            <Style x:Key="Body" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#1F2937, Dark=#E5E7EB}" />
            </Style>

            <!-- Botões -->
            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{toolkit:AppThemeResource PrimaryColor}" />
                <Setter Property="TextColor" Value="{toolkit:AppThemeResource OnPrimaryColor}" />
                <Setter Property="CornerRadius" Value="14" />
                <Setter Property="Padding" Value="18,14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="48" />
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Opacity="0.18" Offset="0,4" Radius="12"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="OutlineButton" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="TextColor" Value="{toolkit:AppThemeResource PrimaryColor}" />
                <Setter Property="BorderColor" Value="{toolkit:AppThemeResource PrimaryColor}" />
                <Setter Property="BorderWidth" Value="1" />
                <Setter Property="CornerRadius" Value="14" />
                <Setter Property="Padding" Value="16,12" />
                <Setter Property="HeightRequest" Value="46" />
                <Setter Property="FontAttributes" Value="Bold" />
            </Style>

            <Style x:Key="TertiaryButton" TargetType="Button" BasedOn="{StaticResource OutlineButton}">
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#EF4444, Dark=#F87171}" />
                <Setter Property="BorderColor" Value="{AppThemeBinding Light=#EF4444, Dark=#F87171}" />
            </Style>

            <!-- Cartão -->
            <Style x:Key="CardBorder" TargetType="Border">
                <Setter Property="BackgroundColor" Value="{toolkit:AppThemeResource CardColor}" />
                <Setter Property="Stroke" Value="{toolkit:AppThemeResource SecondaryColor}" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="Padding" Value="14" />
                <Setter Property="StrokeShape">
                    <Setter.Value>
                        <RoundRectangle CornerRadius="18"/>
                    </Setter.Value>
                </Setter>
                <Setter Property="Shadow">
                    <Setter.Value>
                        <Shadow Opacity="0.14" Offset="0,6" Radius="16"/>
                    </Setter.Value>
                </Setter>
            </Style>

        </ResourceDictionary>
    </ContentPage.Resources>

    <!-- ===== LAYOUT ===== -->
    <Grid RowDefinitions="Auto,Auto,Auto,Auto,*"
          Padding="18"
          RowSpacing="16">

        <!-- Header com gradiente -->
        <Border Grid.Row="0" Padding="20">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="22"/>
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Opacity="0.20" Offset="0,8" Radius="18"/>
            </Border.Shadow>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="{toolkit:AppThemeResource PrimaryColor}" Offset="0" />
                    <GradientStop Color="#7C3AED" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>

            <VerticalStackLayout Spacing="6">
                <Label Text="Dashboard" Style="{StaticResource H1}" />
                <Label Text="Visão geral do MultiSoil EdgeAI"
                       FontSize="13"
                       TextColor="{toolkit:AppThemeResource OnPrimaryColor}"
                       Opacity="0.85"/>
            </VerticalStackLayout>
        </Border>



        <!-- Card: Talhão selecionado -->
        <Border Grid.Row="2" Style="{StaticResource CardBorder}">
            <VerticalStackLayout Spacing="10">
                <Label Text="Talhão selecionado" Style="{StaticResource H2}" />
                <Label Text="{Binding SelectedTalhaoTitle}"
                       Style="{StaticResource Body}"
                       TextColor="{AppThemeBinding Light=#111827, Dark=#F3F4F6}" />

                <Grid ColumnDefinitions="*,*"
                      ColumnSpacing="10"
                      Margin="0,6,0,0">
                    <Button Grid.Column="0"
                            Text="Selecionar Talhão"
                            Style="{StaticResource OutlineButton}"
                            Command="{Binding SelectTalhaoCommand}" />

                    <Button Grid.Column="1"
                            Text="Ver dados em tempo real"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding RealtimeCommand}"
                            IsEnabled="{Binding IsRealtimeEnabled}" />
                </Grid>

                <Label Text="Use o botão acima para mudar o talhão ou abrir a telemetria em tempo real."
                       FontSize="12"
                       TextColor="{StaticResource MutedText}"
                       Margin="0,6,0,0"/>
            </VerticalStackLayout>
        </Border>

        <!-- Logout -->
        <Button Grid.Row="3"
                Text="Logout"
                Style="{StaticResource TertiaryButton}"
                Command="{Binding LogoutCommand}" />
    </Grid>
</ContentPage>
