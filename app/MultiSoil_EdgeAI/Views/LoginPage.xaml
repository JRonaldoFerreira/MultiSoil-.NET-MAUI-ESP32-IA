<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="MultiSoil_EdgeAI.Views.LoginPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:MultiSoil_EdgeAI.ViewModels"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:DataType="vm:LoginViewModel"
    Title="Login"
    BackgroundColor="{toolkit:AppThemeResource SurfaceColor}">

    <!-- ===== LAYOUT ===== -->
    <Grid RowDefinitions="Auto,*" Padding="18" RowSpacing="16">

        <!-- Header com gradiente (mesmo do dashboard) -->
        <Border Grid.Row="0" Padding="20">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="22"/>
            </Border.StrokeShape>
            <Border.Shadow>
                <Shadow Opacity="0.20" Offset="0,8" Radius="18"/>
            </Border.Shadow>
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="{toolkit:AppThemeResource PrimaryColor}" Offset="0" />
                    <GradientStop Color="#7C3AED" Offset="1" />
                </LinearGradientBrush>
            </Border.Background>

            <VerticalStackLayout Spacing="6">
                <Label Text="MultiSoil EdgeAI" Style="{StaticResource H1}" />
                <HorizontalStackLayout Spacing="6">
                    <BoxView WidthRequest="8" HeightRequest="8" CornerRadius="4"
                             Color="#16A34A" VerticalOptions="Center"/>
                    <Label Text="SEU MULTISENSOR INTELIGENTE"
                           FontSize="12"
                           TextColor="{toolkit:AppThemeResource OnPrimaryColor}"
                           Opacity="0.9"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </Border>

        <!-- Card de Login -->
        <Border Grid.Row="1" Style="{StaticResource CardBorder}" Margin="0,8,0,0">
            <ScrollView>
                <VerticalStackLayout Spacing="14">

                    <Label Text="Entrar" Style="{StaticResource H2}" />

                    <!-- Email -->
                    <Label Text="Email" Style="{StaticResource Body}" />
                    <Border Style="{StaticResource FormFieldBorder}">
                        <Entry
                            Style="{StaticResource FormEntry}"
                            Text="{Binding Email}"
                            Placeholder="ana@example.com"
                            Keyboard="Email" />
                    </Border>

                    <!-- Senha -->
                    <Label Text="Senha" Style="{StaticResource Body}" />
                    <Border Style="{StaticResource FormFieldBorder}">
                        <Entry
                            Style="{StaticResource FormEntry}"
                            Text="{Binding Password}"
                            IsPassword="True"
                            Placeholder="••••••••" />
                    </Border>

                    <!-- Ações -->
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <Button
                            Grid.Column="0"
                            Text="Entrar"
                            Style="{StaticResource PrimaryButton}"
                            Command="{Binding EntrarCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}, FallbackValue=True}" />

                        <ActivityIndicator
                            Grid.Column="1"
                            IsRunning="{Binding IsBusy}"
                            IsVisible="{Binding IsBusy}" />
                    </Grid>

                    <!-- Mensagens -->
                    <Label
                        Text="{Binding ErrorMessage}"
                        TextColor="#DC2626"
                        IsVisible="{Binding ErrorMessage, Converter={StaticResource StringNotNullOrEmptyConverter}}" />

                    <!-- Link de cadastro -->
                    <Label Text="Criar conta"
                           TextDecorations="Underline"
                           TextColor="{toolkit:AppThemeResource PrimaryColor}">
                        <Label.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding IrParaCadastroCommand}" NumberOfTapsRequired="1"/>
                        </Label.GestureRecognizers>
                    </Label>

                    <Label Style="{StaticResource Hint}"
                           Text="Ao autenticar, a conexão com a API do ESP32 inicia automaticamente."/>
                </VerticalStackLayout>
            </ScrollView>
        </Border>
    </Grid>
</ContentPage>
